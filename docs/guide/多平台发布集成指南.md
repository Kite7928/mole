# å¤šå¹³å°å‘å¸ƒåŠŸèƒ½ - ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

åŸºäº Mixpost æ ¸å¿ƒé€»è¾‘å®ç°çš„å¤šå¹³å°æ–‡ç« å‘å¸ƒåŠŸèƒ½ï¼Œæ”¯æŒå°†æ–‡ç« ä¸€é”®å‘å¸ƒåˆ°çŸ¥ä¹ã€æ˜é‡‘ã€ä»Šæ—¥å¤´æ¡ç­‰å¤šä¸ªå¹³å°ã€‚

### æ”¯æŒçš„å¹³å°

| å¹³å° | å›¾æ ‡ | æ”¯æŒæ ¼å¼ | è¯´æ˜ |
|------|------|---------|------|
| çŸ¥ä¹ | ğŸ“š | HTML/Markdown | å‘å¸ƒåˆ°çŸ¥ä¹ä¸“æ  |
| æ˜é‡‘ | ğŸš€ | Markdown | å‘å¸ƒåˆ°æ˜é‡‘ç¤¾åŒº |
| ä»Šæ—¥å¤´æ¡ | ğŸ“° | HTML | å‘å¸ƒåˆ°å¤´æ¡å· |
| CSDN | ğŸ’» | HTML/Markdown | å‘å¸ƒåˆ°CSDNåšå®¢ |
| ç®€ä¹¦ | ğŸ“ | Markdown | å‘å¸ƒåˆ°ç®€ä¹¦ |
| SegmentFault | ğŸ”§ | HTML/Markdown | å‘å¸ƒåˆ°æ€å¦ç¤¾åŒº |
| å¼€æºä¸­å›½ | ğŸŒ | HTML/Markdown | å‘å¸ƒåˆ°å¼€æºä¸­å›½ |
| Bç«™ä¸“æ  | ğŸ“º | HTML | å‘å¸ƒåˆ°Bilibiliä¸“æ  |

---

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®å¹³å°

#### é€šè¿‡APIé…ç½®

```bash
# ä¿å­˜çŸ¥ä¹å¹³å°é…ç½®
curl -X POST http://localhost:8000/api/multiplatform/configs \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "zhihu",
    "cookies": "{\"z_c0\": \"your_cookie_value\"}",
    "auto_publish": false,
    "default_category": "ç§‘æŠ€"
  }'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "çŸ¥ä¹ é…ç½®å·²ä¿å­˜",
  "platform": "zhihu",
  "configured": true
}
```

### 2. è·å–å¹³å°åˆ—è¡¨

```bash
curl http://localhost:8000/api/multiplatform/platforms
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "platforms": [
    {
      "type": "zhihu",
      "name": "çŸ¥ä¹",
      "icon": "ğŸ“š",
      "description": "å‘å¸ƒåˆ°çŸ¥ä¹ä¸“æ ",
      "configured": true,
      "support_markdown": true,
      "support_html": true
    },
    {
      "type": "juejin",
      "name": "æ˜é‡‘",
      "icon": "ğŸš€",
      "description": "å‘å¸ƒåˆ°æ˜é‡‘ç¤¾åŒº",
      "configured": false,
      "support_markdown": true,
      "support_html": false
    }
  ]
}
```

### 3. å‘å¸ƒæ–‡ç« 

#### ç«‹å³å‘å¸ƒ

```bash
curl -X POST http://localhost:8000/api/multiplatform/publish \
  -H "Content-Type: application/json" \
  -d '{
    "article_id": 1,
    "platforms": ["zhihu", "juejin"],
    "publish_now": true
  }'
```

#### å®šæ—¶å‘å¸ƒ

```bash
curl -X POST http://localhost:8000/api/multiplatform/publish \
  -H "Content-Type: application/json" \
  -d '{
    "article_id": 1,
    "platforms": ["zhihu"],
    "publish_now": false,
    "scheduled_at": "2026-02-10T10:00:00"
  }'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "å·²å‘å¸ƒåˆ° 2 ä¸ªå¹³å°",
  "results": [
    {
      "platform": "zhihu",
      "success": true,
      "message": "æ–‡ç« å·²å‘å¸ƒåˆ°çŸ¥ä¹",
      "article_id": "zhihu_1234567890",
      "article_url": "https://zhuanlan.zhihu.com/p/1234567890"
    },
    {
      "platform": "juejin",
      "success": true,
      "message": "æ–‡ç« å·²å‘å¸ƒåˆ°æ˜é‡‘",
      "article_id": "juejin_1234567890",
      "article_url": "https://juejin.cn/post/1234567890"
    }
  ]
}
```

### 4. æŸ¥çœ‹å‘å¸ƒå†å²

```bash
curl http://localhost:8000/api/multiplatform/history/1
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "history": [
    {
      "id": 1,
      "platform": "zhihu",
      "status": "success",
      "platform_article_id": "zhihu_1234567890",
      "platform_article_url": "https://zhuanlan.zhihu.com/p/1234567890",
      "view_count": 100,
      "like_count": 10,
      "comment_count": 2,
      "created_at": "2026-02-10T10:00:00",
      "published_at": "2026-02-10T10:01:00"
    }
  ]
}
```

---

## APIç«¯ç‚¹

### å¹³å°ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/multiplatform/platforms` | GET | è·å–æ”¯æŒçš„å¹³å°åˆ—è¡¨ |
| `/api/multiplatform/configs` | GET | è·å–æ‰€æœ‰å¹³å°é…ç½® |
| `/api/multiplatform/configs/{platform}` | GET | è·å–æŒ‡å®šå¹³å°é…ç½® |
| `/api/multiplatform/configs` | POST | ä¿å­˜å¹³å°é…ç½® |
| `/api/multiplatform/configs/{platform}` | DELETE | åˆ é™¤å¹³å°é…ç½® |

### å‘å¸ƒç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/multiplatform/publish` | POST | å‘å¸ƒæ–‡ç« åˆ°å¤šä¸ªå¹³å° |
| `/api/multiplatform/history/{article_id}` | GET | è·å–æ–‡ç« å‘å¸ƒå†å² |
| `/api/multiplatform/tasks` | GET | è·å–å‘å¸ƒä»»åŠ¡åˆ—è¡¨ |
| `/api/multiplatform/tasks/{task_id}` | GET | è·å–å‘å¸ƒä»»åŠ¡è¯¦æƒ… |

---

## å¹³å°é…ç½®è¯´æ˜

### çŸ¥ä¹é…ç½®

çŸ¥ä¹éœ€è¦é…ç½®Cookieæ¥ç™»å½•ã€‚è·å–æ­¥éª¤ï¼š

1. ç™»å½•çŸ¥ä¹ç½‘é¡µç‰ˆ
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. åˆ‡æ¢åˆ° "Application" æˆ– "å­˜å‚¨" æ ‡ç­¾
4. æ‰¾åˆ° "Cookies" â†’ "https://www.zhihu.com"
5. å¤åˆ¶ `z_c0` Cookieçš„å€¼

```json
{
  "platform": "zhihu",
  "cookies": "{\"z_c0\": \"your_cookie_value\"}"
}
```

### æ˜é‡‘é…ç½®

æ˜é‡‘éœ€è¦é…ç½®Cookieæ¥ç™»å½•ã€‚è·å–æ­¥éª¤ï¼š

1. ç™»å½•æ˜é‡‘ç½‘é¡µç‰ˆ
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. åˆ‡æ¢åˆ° "Application" æˆ– "å­˜å‚¨" æ ‡ç­¾
4. æ‰¾åˆ° "Cookies" â†’ "https://juejin.cn"
5. å¤åˆ¶ `sessionid` Cookieçš„å€¼

```json
{
  "platform": "juejin",
  "cookies": "{\"sessionid\": \"your_cookie_value\"}"
}
```

### ä»Šæ—¥å¤´æ¡é…ç½®

å¤´æ¡éœ€è¦é…ç½®Cookieæ¥ç™»å½•ã€‚è·å–æ­¥éª¤ï¼š

1. ç™»å½•å¤´æ¡å·å¹³å°
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
3. åˆ‡æ¢åˆ° "Application" æˆ– "å­˜å‚¨" æ ‡ç­¾
4. æ‰¾åˆ° "Cookies" â†’ "https://mp.toutiao.com"
5. å¤åˆ¶ `sessionid` Cookieçš„å€¼

```json
{
  "platform": "toutiao",
  "cookies": "{\"sessionid\": \"your_cookie_value\"}"
}
```

---

## æ•°æ®æ¨¡å‹

### PublishRecordï¼ˆå‘å¸ƒè®°å½•ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | è®°å½•ID |
| article_id | Integer | æ–‡ç« ID |
| platform | PlatformType | å‘å¸ƒå¹³å° |
| status | PublishStatus | å‘å¸ƒçŠ¶æ€ |
| platform_article_id | String | å¹³å°æ–‡ç« ID |
| platform_article_url | String | å¹³å°æ–‡ç« URL |
| view_count | Integer | é˜…è¯»é‡ |
| like_count | Integer | ç‚¹èµæ•° |
| comment_count | Integer | è¯„è®ºæ•° |
| published_at | DateTime | å‘å¸ƒæ—¶é—´ |

### PublishTaskï¼ˆå‘å¸ƒä»»åŠ¡ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä»»åŠ¡ID |
| name | String | ä»»åŠ¡åç§° |
| article_id | Integer | æ–‡ç« ID |
| target_platforms | String | ç›®æ ‡å¹³å°åˆ—è¡¨ï¼ˆJSONï¼‰ |
| status | PublishStatus | ä»»åŠ¡çŠ¶æ€ |
| total_count | Integer | æ€»å¹³å°æ•° |
| success_count | Integer | æˆåŠŸæ•° |
| failed_count | Integer | å¤±è´¥æ•° |

---

## å®šæ—¶å‘å¸ƒ

### åˆ›å»ºå®šæ—¶å‘å¸ƒä»»åŠ¡

```bash
curl -X POST http://localhost:8000/api/multiplatform/publish \
  -H "Content-Type: application/json" \
  -d '{
    "article_id": 1,
    "platforms": ["zhihu"],
    "publish_now": false,
    "scheduled_at": "2026-02-10T14:00:00"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "å·²åˆ›å»ºå®šæ—¶å‘å¸ƒä»»åŠ¡",
  "task_id": "schedule_1_1234567890",
  "scheduled_at": "2026-02-10T14:00:00"
}
```

### æŸ¥çœ‹å®šæ—¶ä»»åŠ¡

```bash
curl http://localhost:8000/api/multiplatform/tasks
```

---

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯

#### 1. å¹³å°æœªé…ç½®

```json
{
  "success": false,
  "platform": "zhihu",
  "message": "æœªæ‰¾åˆ°å¹³å° zhihu çš„å‘å¸ƒå™¨"
}
```

**è§£å†³æ–¹æ³•**ï¼šå…ˆé…ç½®å¹³å°çš„Cookieæˆ–Tokenã€‚

#### 2. Cookieè¿‡æœŸ

```json
{
  "success": false,
  "platform": "zhihu",
  "message": "æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ"
}
```

**è§£å†³æ–¹æ³•**ï¼šé‡æ–°è·å–Cookieå¹¶æ›´æ–°é…ç½®ã€‚

#### 3. å†…å®¹éªŒè¯å¤±è´¥

```json
{
  "success": false,
  "platform": "zhihu",
  "message": "æ ‡é¢˜ä¸èƒ½ä¸ºç©ºä¸”è‡³å°‘5ä¸ªå­—ç¬¦"
}
```

**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥æ–‡ç« æ ‡é¢˜å’Œå†…å®¹æ˜¯å¦ç¬¦åˆå¹³å°è¦æ±‚ã€‚

---

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
cd backend
pytest tests/test_multiplatform_service.py -v
```

### æµ‹è¯•è¦†ç›–

- âœ… å¹³å°åˆ—è¡¨è·å–
- âœ… å¹³å°é…ç½®ç®¡ç†
- âœ… å†…å®¹éªŒè¯å’Œè½¬æ¢
- âœ… å•å¹³å°å‘å¸ƒ
- âœ… å¤šå¹³å°æ‰¹é‡å‘å¸ƒ
- âœ… å®šæ—¶å‘å¸ƒ
- âœ… å‘å¸ƒå†å²æŸ¥è¯¢
- âœ… ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

---

## æ³¨æ„äº‹é¡¹

1. **Cookieæœ‰æ•ˆæœŸ**ï¼šCookieä¼šè¿‡æœŸï¼Œéœ€è¦å®šæœŸæ›´æ–°
2. **å¹³å°é™åˆ¶**ï¼šå„å¹³å°æœ‰å‘å¸ƒé¢‘ç‡é™åˆ¶ï¼Œè¯·åˆç†è®¾ç½®å‘å¸ƒé—´éš”
3. **å†…å®¹é€‚é…**ï¼šä¸åŒå¹³å°å¯¹å†…å®¹æ ¼å¼è¦æ±‚ä¸åŒï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢
4. **é”™è¯¯é‡è¯•**ï¼šå‘å¸ƒå¤±è´¥ä¼šè‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œé—´éš”5ç§’
5. **å®šæ—¶å‘å¸ƒ**ï¼šå®šæ—¶ä»»åŠ¡ä¾èµ–ç³»ç»Ÿæ—¶é—´ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨æ—¶é—´å‡†ç¡®

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] å®ç°å®é™…çš„Seleniumè‡ªåŠ¨åŒ–å‘å¸ƒ
- [ ] æ·»åŠ å¹³å°ç»Ÿè®¡æ•°æ®åŒæ­¥
- [ ] æ”¯æŒæ›´å¤šå¹³å°ï¼ˆå°çº¢ä¹¦ã€Bç«™ç­‰ï¼‰
- [ ] æ·»åŠ å‘å¸ƒé¢„è§ˆåŠŸèƒ½
- [ ] å®ç°å†…å®¹æ™ºèƒ½é€‚é…

---

**æœ€åæ›´æ–°**ï¼š2026å¹´2æœˆ10æ—¥  
**ç‰ˆæœ¬**ï¼šv1.0.0