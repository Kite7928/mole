"""
æ™ºèƒ½å†™ä½œæ¨¡æ¿ç³»ç»Ÿ
æ ¹æ®æ–°é—»ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„å†™ä½œé£æ ¼
"""

from typing import Dict, Any, List
from enum import Enum
import random


class ArticleType(str, Enum):
    """æ–‡ç« ç±»å‹æšä¸¾"""
    SOCIAL = "social"           # ç¤¾ä¼šæ°‘ç”Ÿç±»
    BUSINESS = "business"       # å•†ä¸šè´¢ç»ç±»
    TECH = "tech"               # ç§‘æŠ€æ•°ç ç±»
    LIFESTYLE = "lifestyle"     # ç”Ÿæ´»æ–¹å¼ç±»
    ENTERTAINMENT = "entertainment"  # å¨±ä¹ä¼‘é—²ç±»


class WritingTemplate:
    """å†™ä½œæ¨¡æ¿ç±»"""

    # ============ 1. ç¤¾ä¼šæ°‘ç”Ÿç±»æ¨¡æ¿ ============
    SOCIAL_TEMPLATES = {
        "name": "ç¤¾ä¼šæ°‘ç”Ÿ",
        "description": "é€‚åˆæ˜¥è¿ã€æ°‘ç”Ÿã€ç¤¾ä¼šçƒ­ç‚¹ç­‰æ–°é—»",
        "openings": [
            "çœ‹åˆ°è¿™æ¡æ–°é—»çš„æ—¶å€™ï¼Œæˆ‘æ­£åœ¨{åœºæ™¯}ã€‚",
            "è¯´å®è¯ï¼Œçœ‹åˆ°è¿™ä¸ªæ•°å­—çš„æ—¶å€™ï¼Œæˆ‘æ„£äº†ä¸€ä¸‹ã€‚",
            "å¦‚æœæ­¤åˆ»ä½ æ­£åœ¨{åœºæ™¯}ï¼Œä½ åº”è¯¥å·²ç»æ„Ÿå—åˆ°äº†ã€‚",
            "ä»Šå¤©åˆ·åˆ°ä¸ªæ¶ˆæ¯ï¼Œè®©æˆ‘æƒ³è·Ÿä½ èŠèŠã€‚",
            "å…ˆé—®ä½ ä¸ªé—®é¢˜ï¼š{é—®é¢˜}ï¼Ÿ",
        ],
        "angles": [
            {
                "title": "ğŸ”¥ è¿™å±Š{ä¸»é¢˜}ï¼Œæœ‰ç‚¹çŒ›",
                "content": "å…ˆè¯´æ•°æ®ã€‚{æ•°æ®è¯¦æƒ…}ã€‚æˆ‘ç‰¹æ„æŸ¥äº†ä¸‹å¯¹æ¯”ï¼š{å¯¹æ¯”æ•°æ®}ã€‚{åˆ†æè§‚ç‚¹}",
            },
            {
                "title": "ğŸ’¡ å‡ ä¸ªç»†èŠ‚å€¼å¾—æ³¨æ„",
                "content": "ç¬¬ä¸€ï¼Œ{ç»†èŠ‚1}ã€‚{åˆ†æ1}\n\nç¬¬äºŒï¼Œ{ç»†èŠ‚2}ã€‚{åˆ†æ2}",
            },
            {
                "title": "ğŸ¯ è¿™ä¸ä»…æ˜¯{äº‹ä»¶}ï¼Œæ›´æ˜¯{æ·±å±‚æ„ä¹‰}",
                "content": "ä½ å¯èƒ½ä¼šè¯´ï¼Œä¸å°±æ˜¯{è¡¨é¢ç°è±¡}å—ï¼Ÿä½†ä½œä¸ºä¸€ä¸ªé•¿æœŸå…³æ³¨{é¢†åŸŸ}çš„äººï¼Œæˆ‘çœ‹åˆ°äº†ä¸ä¸€æ ·çš„ä¸œè¥¿ã€‚\n\n{æ ¸å¿ƒè§‚ç‚¹}ï¼š\n- {è®ºæ®1}\n- {è®ºæ®2}\n- {è®ºæ®3}",
            },
        ],
        "quotes": [
            "æ•°æ®æ˜¯å†°å†·çš„ï¼Œä½†æ•°æ®èƒŒåçš„äººæ˜¯æ¸©æš–çš„ã€‚",
            "æ¯ä¸€ä¸ªæ•°å­—ï¼Œéƒ½æ˜¯ä¸€ä¸ªçœŸå®çš„äººã€ä¸€æ®µçœŸå®çš„æ•…äº‹ã€‚",
            "çœ‹æ‡‚äº†æ•°æ®ï¼Œå°±çœ‹æ‡‚äº†è¿™ä¸ªæ—¶ä»£ã€‚",
            "å®è§‚æ˜¯æ•°æ®ï¼Œå¾®è§‚æ˜¯ä¸€ä¸ªä¸ªå…·ä½“çš„äººç”Ÿã€‚",
        ],
        "endings": [
            "è¿™{æ•°å­—}{å•ä½}é‡Œï¼Œæœ‰ä½ çš„é‚£ä¸€{é‡è¯}å—ï¼Ÿè¯„è®ºåŒºèŠèŠã€‚",
            "ä½ {åŠ¨ä½œ}äº†å—ï¼Ÿè¿˜æ˜¯æ­£åœ¨{çŠ¶æ€}ï¼Ÿ",
            "{é—®é¢˜}ï¼Œä½ çš„ç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ",
            "å†™åˆ°è¿™å„¿ï¼Œçªç„¶æƒ³å¬å¬ä½ çš„æ•…äº‹ã€‚",
        ],
        "style_hints": [
            "ç”¨ç¬¬ä¸€äººç§°ï¼Œåƒè·Ÿæœ‹å‹èŠå¤©",
            "æ•°æ®è¦å…·è±¡åŒ–ï¼ˆ4200ä¸‡â†’åœ°çƒåˆ°æœˆçƒï¼‰",
            "å¤šæ'ä½ 'ï¼Œå¢å¼ºä»£å…¥æ„Ÿ",
            "åŠ å…¥ä¸ªäººæ„Ÿå—ï¼šæƒŠè®¶ã€æ„Ÿæ…¨ã€æ€è€ƒ",
        ],
    }

    # ============ 2. å•†ä¸šè´¢ç»ç±»æ¨¡æ¿ ============
    BUSINESS_TEMPLATES = {
        "name": "å•†ä¸šè´¢ç»",
        "description": "é€‚åˆè´¢æŠ¥ã€å¸‚åœºã€å•†ä¸šåŠ¨æ€ç­‰æ–°é—»",
        "openings": [
            "èµ„æœ¬å¸‚åœºæ°¸è¿œä¸ç¼ºæ•…äº‹ï¼Œä½†è¿™ä¸ªæ•…äº‹æœ‰ç‚¹ä¸ä¸€æ ·ã€‚",
            "æ˜¨æ™šçœ‹åˆ°è¿™åˆ™æ¶ˆæ¯ï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´æƒ³çš„æ˜¯ï¼š{æ ¸å¿ƒé—®é¢˜}",
            "å•†ä¸šä¸–ç•Œæœ‰ä¸ªè§„å¾‹ï¼š{è§„å¾‹}ã€‚è¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–ã€‚",
            "å…ˆæŠ›ä¸€ä¸ªé—®é¢˜ï¼š{é—®é¢˜}ï¼Ÿçœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ ä¼šæœ‰ç­”æ¡ˆã€‚",
        ],
        "angles": [
            {
                "title": "ğŸ“Š å…ˆçœ‹æ•°æ®",
                "content": "ç›´æ¥ä¸Šå¹²è´§ï¼š\n\n{æ•°æ®åˆ—è¡¨}\n\nè¿™äº›æ•°å­—è¯´æ˜ä»€ä¹ˆï¼Ÿ",
            },
            {
                "title": "ğŸ” æ‹†è§£é€»è¾‘",
                "content": "ä¸ºä»€ä¹ˆ{ç°è±¡}ï¼Ÿæˆ‘è®¤ä¸ºæœ‰ä¸‰ä¸ªåŸå› ï¼š\n\n**ç¬¬ä¸€ï¼Œ{åŸå› 1}**\n{è§£é‡Š1}\n\n**ç¬¬äºŒï¼Œ{åŸå› 2}**\n{è§£é‡Š2}\n\n**ç¬¬ä¸‰ï¼Œ{åŸå› 3}**\n{è§£é‡Š3}",
            },
            {
                "title": "ğŸ’° å¯¹æ™®é€šäººçš„å½±å“",
                "content": "ä½ å¯èƒ½ä¼šé—®ï¼šè¿™è·Ÿæˆ‘æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\n\nå…³ç³»å¤§äº†ã€‚{å½±å“åˆ†æ}\n\n{å…·ä½“å»ºè®®}",
            },
        ],
        "quotes": [
            "å•†ä¸šçš„æœ¬è´¨æ˜¯åˆ›é€ ä»·å€¼ï¼Œè€Œéè¿½é€çƒ­ç‚¹ã€‚",
            "çœ‹æ‡‚è¶‹åŠ¿çš„äººèµšé’±ï¼Œçœ‹ä¸æ‡‚è¶‹åŠ¿çš„äººä¹°å•ã€‚",
            "æ•°æ®ä¸ä¼šè¯´è°ï¼Œä½†è§£è¯»æ•°æ®çš„äººå¯èƒ½ä¼šã€‚",
            "æœ€å¥½çš„æŠ•èµ„ï¼Œæ˜¯æŠ•èµ„è‡ªå·±çš„è®¤çŸ¥ã€‚",
        ],
        "endings": [
            "ä½ æ€ä¹ˆçœ‹{äº‹ä»¶}ï¼Ÿæ˜¯{è§‚ç‚¹A}è¿˜æ˜¯{è§‚ç‚¹B}ï¼Ÿ",
            "{é—®é¢˜}ï¼Œæ¬¢è¿è¯„è®ºåŒºäº¤æµã€‚",
            "å…³äº{ä¸»é¢˜}ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆæƒ³äº†è§£ï¼Ÿç•™è¨€å‘Šè¯‰æˆ‘ã€‚",
        ],
        "style_hints": [
            "é€»è¾‘è¦æ¸…æ™°ï¼šæ•°æ®â†’åˆ†æâ†’ç»“è®º",
            "ä¸“ä¸šæœ¯è¯­è¦è§£é‡Š",
            "ç»™å‡º actionable çš„å»ºè®®",
            "ä¿æŒå®¢è§‚ç†æ€§",
        ],
    }

    # ============ 3. ç§‘æŠ€æ•°ç ç±»æ¨¡æ¿ ============
    TECH_TEMPLATES = {
        "name": "ç§‘æŠ€æ•°ç ",
        "description": "é€‚åˆæ–°äº§å“ã€æŠ€æœ¯çªç ´ã€è¡Œä¸šåŠ¨æ€ç­‰æ–°é—»",
        "openings": [
            "ç§‘æŠ€åœˆåˆå‡ºå¤§æ–°é—»äº†ï¼",
            "ä½œä¸ºä¸€ä¸ª{èº«ä»½}ï¼Œçœ‹åˆ°è¿™åˆ™æ¶ˆæ¯æˆ‘{æƒ…ç»ª}ã€‚",
            "è¿™ä¸ªäº§å“æŠ€æœ¯ï¼Œå¯èƒ½ä¼šæ”¹å˜{é¢†åŸŸ}çš„æ ¼å±€ã€‚",
            "å…ˆé—®ä¸ªé—®é¢˜ï¼š{é—®é¢˜}ï¼Ÿç­”æ¡ˆå¯èƒ½ä¼šè®©ä½ {æƒ…ç»ª}ã€‚",
        ],
        "angles": [
            {
                "title": "ğŸš€ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ",
                "content": "ç®€å•è¯´ï¼Œ{é€šä¿—è§£é‡Š}ã€‚\n\næŠ€æœ¯åŸç†ï¼š{åŸç†ç®€è¿°}ï¼ˆä¸ç”¨æ‡‚ï¼ŒçŸ¥é“å‰å®³å°±è¡Œï¼‰",
            },
            {
                "title": "âš¡ æœ‰ä»€ä¹ˆäº®ç‚¹ï¼Ÿ",
                "content": "æˆ‘æ€»ç»“äº†{æ•°å­—}ä¸ªæ ¸å¿ƒçœ‹ç‚¹ï¼š\n\n{äº®ç‚¹åˆ—è¡¨}\n\n{æ·±åº¦è§£è¯»}",
            },
            {
                "title": "ğŸ¤” å€¼å¾—ä¹°/ç”¨å—ï¼Ÿ",
                "content": "å…ˆè¯´ç»“è®ºï¼š{ç»“è®º}\n\n**é€‚åˆäººç¾¤ï¼š**\n{é€‚åˆäººç¾¤}\n\n**ä¸é€‚åˆäººç¾¤ï¼š**\n{ä¸é€‚åˆäººç¾¤}\n\n**è´­ä¹°å»ºè®®ï¼š**\n{å»ºè®®}",
            },
        ],
        "quotes": [
            "æŠ€æœ¯æœ¬èº«ä¸é‡è¦ï¼ŒæŠ€æœ¯å¸¦æ¥çš„æ”¹å˜æ‰é‡è¦ã€‚",
            "ä»Šå¤©çš„é»‘ç§‘æŠ€ï¼Œæ˜¯æ˜å¤©çš„åŸºç¡€è®¾æ–½ã€‚",
            "å¥½äº§å“è§£å†³ç—›ç‚¹ï¼Œä¼Ÿå¤§çš„äº§å“åˆ›é€ éœ€æ±‚ã€‚",
            "ç§‘æŠ€çš„æ¸©åº¦ï¼Œåœ¨äºå®ƒè®©ç”Ÿæ´»æ›´ç¾å¥½ã€‚",
        ],
        "endings": [
            "ä½ ä¼šè€ƒè™‘{åŠ¨ä½œ}å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ",
            "å…³äºè¿™ä¸ªäº§å“æŠ€æœ¯ï¼Œä½ æœ€å…³å¿ƒä»€ä¹ˆï¼Ÿ",
            "{é—®é¢˜}ï¼Œæ¥è¯„è®ºåŒºèŠèŠã€‚",
        ],
        "style_hints": [
            "å¤æ‚æŠ€æœ¯è¦é€šä¿—åŒ–",
            "å¤šç”¨ç±»æ¯”å’Œæ¯”å–»",
            "ç»™å‡ºæ˜ç¡®çš„è´­ä¹°/ä½¿ç”¨å»ºè®®",
            "ä¿æŒå¯¹æŠ€æœ¯çš„çƒ­æƒ…",
        ],
    }

    # ============ 4. ç”Ÿæ´»æ–¹å¼ç±»æ¨¡æ¿ ============
    LIFESTYLE_TEMPLATES = {
        "name": "ç”Ÿæ´»æ–¹å¼",
        "description": "é€‚åˆå¥åº·ã€æ—…è¡Œã€ç¾é£Ÿã€å®¶å±…ç­‰æ–°é—»",
        "openings": [
            "æœ€è¿‘å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š{ç°è±¡}",
            "ä½œä¸ºä¸€ä¸ª{èº«ä»½}ï¼Œæˆ‘å¿…é¡»è·Ÿä½ åˆ†äº«è¿™ä¸ªã€‚",
            "ä»Šå¤©æƒ³èŠç‚¹è½»æ¾çš„ï¼š{ä¸»é¢˜}",
            "å…ˆé—®ä½ ï¼š{é—®é¢˜}ï¼Ÿ",
        ],
        "angles": [
            {
                "title": "ğŸŒŸ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ",
                "content": "ç®€å•æ¥è¯´ï¼Œ{é€šä¿—è§£é‡Š}ã€‚\n\næˆ‘ç¬¬ä¸€æ¬¡çŸ¥é“çš„æ—¶å€™ï¼Œ{ä¸ªäººæ„Ÿå—}",
            },
            {
                "title": "ğŸ’¡ æœ‰ä»€ä¹ˆç”¨ï¼Ÿ",
                "content": "å®é™…ä½“éªŒä¸‹æ¥ï¼Œæˆ‘å‘ç°{å‘ç°}ï¼š\n\n**å¥½å¤„1ï¼š**{å¥½å¤„1}\n**å¥½å¤„2ï¼š**{å¥½å¤„2}\n**å¥½å¤„3ï¼š**{å¥½å¤„3}",
            },
            {
                "title": "ğŸ“ æˆ‘çš„å»ºè®®",
                "content": "å¦‚æœä½ ä¹Ÿæƒ³{åŠ¨ä½œ}ï¼Œæˆ‘æœ‰{æ•°å­—}ä¸ªå»ºè®®ï¼š\n\n{å»ºè®®åˆ—è¡¨}\n\n{æ³¨æ„äº‹é¡¹}",
            },
        ],
        "quotes": [
            "ç”Ÿæ´»ä¸æ˜¯èµ¶è·¯ï¼Œè€Œæ˜¯æ„Ÿå—è·¯ã€‚",
            "æœ€å¥½çš„ç”Ÿæ´»ï¼Œæ˜¯é€‚åˆè‡ªå·±çš„ç”Ÿæ´»ã€‚",
            "å°ç¡®å¹¸ï¼Œæ‰æ˜¯ç”Ÿæ´»çš„çœŸè°›ã€‚",
            "æ‡‚å¾—ç”Ÿæ´»çš„äººï¼Œæ›´æ‡‚å¾—å·¥ä½œçš„æ„ä¹‰ã€‚",
        ],
        "endings": [
            "ä½ æœ‰ä»€ä¹ˆ{ä¸»é¢˜}çš„å¿ƒå¾—ï¼Ÿæ¬¢è¿åˆ†äº«ã€‚",
            "{é—®é¢˜}ï¼Ÿè¯„è®ºåŒºç­‰ä½ ã€‚",
            "å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè®°å¾—åˆ†äº«ç»™æœ‹å‹~",
        ],
        "style_hints": [
            "è¯­æ°”è½»æ¾è‡ªç„¶",
            "å¤šåˆ†äº«ä¸ªäººä½“éªŒ",
            "å®ç”¨æ€§å¼ºï¼Œæœ‰å¹²è´§",
            "å¤šç”¨ emoji å¢åŠ äº²å’ŒåŠ›",
        ],
    }

    # ============ 5. å¨±ä¹ä¼‘é—²ç±»æ¨¡æ¿ ============
    ENTERTAINMENT_TEMPLATES = {
        "name": "å¨±ä¹ä¼‘é—²",
        "description": "é€‚åˆå½±è§†ã€æ˜æ˜Ÿã€ç»¼è‰ºã€å…«å¦ç­‰æ–°é—»",
        "openings": [
            "åƒç“œåƒåˆ°è‡ªå·±å®¶ï¼",
            "è¿™ä¹Ÿå¤ª{å½¢å®¹è¯}äº†å§ï¼",
            "ä»Šå¤©çš„å¿«ä¹æºæ³‰ï¼š{ä¸»é¢˜}",
            "åˆšçœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œæˆ‘{ååº”}",
        ],
        "angles": [
            {
                "title": "ğŸ‰ å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ",
                "content": "å¿«é€Ÿå¤ç›˜ï¼š{äº‹ä»¶ç»è¿‡}\n\nå…³é”®ä¿¡æ¯ï¼š\n{ä¿¡æ¯åˆ—è¡¨}",
            },
            {
                "title": "ğŸ¤· æ€ä¹ˆçœ‹ï¼Ÿ",
                "content": "è¯´å®è¯ï¼Œ{è§‚ç‚¹}ã€‚\n\n{åˆ†æ}\n\n{è°ƒä¾ƒ/åæ§½}",
            },
            {
                "title": "ğŸ’­ å»¶ä¼¸æ€è€ƒ",
                "content": "è¿™ä»¶äº‹èƒŒåï¼Œå…¶å®åæ˜ äº†{æ·±å±‚ç°è±¡}ã€‚\n\n{è¿›ä¸€æ­¥åˆ†æ}",
            },
        ],
        "quotes": [
            "å¨±ä¹åœˆæ°¸è¿œä¸ç¼ºç“œï¼Œç¼ºçš„æ˜¯å¥½ç“œã€‚",
            "ç†æ€§åƒç“œï¼Œå¿«ä¹åŠ å€ã€‚",
            "æˆå¦‚äººç”Ÿï¼Œäººç”Ÿå¦‚æˆã€‚",
            "åƒç“œç¾¤ä¼—ä¹Ÿæ˜¯ç¾¤ä¼—ã€‚",
        ],
        "endings": [
            "ä½ æ€ä¹ˆçœ‹ï¼Ÿç«™å“ªè¾¹ï¼Ÿ",
            "{é—®é¢˜}ï¼Œè¯„è®ºåŒºè§ï¼",
            "å…³æ³¨æˆ‘ï¼Œåƒç“œä¸è¿·è·¯~",
        ],
        "style_hints": [
            "è½»æ¾è°ƒä¾ƒï¼Œåˆ«å¤ªä¸¥è‚ƒ",
            "é€‚å½“ç©æ¢—",
            "ä¿æŒä¸­ç«‹ï¼Œä¸ç«™é˜Ÿ",
            "å¨±ä¹è‡³ä¸Šï¼Œå¼€å¿ƒå°±å¥½",
        ],
    }

    # ç±»å‹æ˜ å°„è¡¨
    TEMPLATE_MAP = {
        ArticleType.SOCIAL: SOCIAL_TEMPLATES,
        ArticleType.BUSINESS: BUSINESS_TEMPLATES,
        ArticleType.TECH: TECH_TEMPLATES,
        ArticleType.LIFESTYLE: LIFESTYLE_TEMPLATES,
        ArticleType.ENTERTAINMENT: ENTERTAINMENT_TEMPLATES,
    }

    # ç±»å‹å…³é”®è¯æ˜ å°„ï¼ˆç”¨äºè‡ªåŠ¨è¯†åˆ«ï¼‰
    TYPE_KEYWORDS = {
        ArticleType.SOCIAL: [
            "æ˜¥è¿", "äº¤é€š", "å¤©æ°”", "ç–«æƒ…", "æ•™è‚²", "åŒ»ç–—", "å…»è€", "ä½æˆ¿",
            "å°±ä¸š", "æ”¶å…¥", "ç‰©ä»·", "æ°‘ç”Ÿ", "ç¤¾ä¼š", "å…¬å…±", "æ”¿ç­–", "æ³•è§„",
            "äº‹æ•…", "ç¾å®³", "æ•‘æ´", "å…¬ç›Š", "å¿—æ„¿è€…", "ç¤¾åŒº", "å®¶åº­"
        ],
        ArticleType.BUSINESS: [
            "è´¢æŠ¥", "è¥æ”¶", "åˆ©æ¶¦", "è‚¡ä»·", "ä¸Šå¸‚", "èèµ„", "æŠ•èµ„", "å¹¶è´­",
            "å¸‚åœº", "è¡Œä¸š", "ä¼ä¸š", "å…¬å¸", "å“ç‰Œ", "å•†ä¸š", "ç»æµ", "é‡‘è",
            "æˆ¿åœ°äº§", "è‚¡å¸‚", "åŸºé‡‘", "ç†è´¢", "æ¶ˆè´¹", "é›¶å”®", "ç”µå•†"
        ],
        ArticleType.TECH: [
            "ç§‘æŠ€", "æŠ€æœ¯", "AI", "äººå·¥æ™ºèƒ½", "èŠ¯ç‰‡", "æ‰‹æœº", "ç”µè„‘", "æ±½è½¦",
            "äº’è”ç½‘", "è½¯ä»¶", "ç¡¬ä»¶", "ç®—æ³•", "æ•°æ®", "äº‘è®¡ç®—", "5G", "æ–°èƒ½æº",
            "å‘å¸ƒ", "æ–°å“", "å‘å¸ƒä¼š", "å‡çº§", "è¿­ä»£", "åˆ›æ–°", "çªç ´"
        ],
        ArticleType.LIFESTYLE: [
            "å¥åº·", "å…»ç”Ÿ", "å¥èº«", "å‡è‚¥", "ç¾é£Ÿ", "èœè°±", "é¤å…", "æ—…è¡Œ",
            "æ—…æ¸¸", "é…’åº—", "æ°‘å®¿", "å®¶å±…", "è£…ä¿®", "æ”¶çº³", "ç©¿æ­", "æ—¶å°š",
            "æŠ¤è‚¤", "åŒ–å¦†", "è¯»ä¹¦", "ç”µå½±", "éŸ³ä¹", "å® ç‰©", "æ¤ç‰©"
        ],
        ArticleType.ENTERTAINMENT: [
            "æ˜æ˜Ÿ", "æ¼”å‘˜", "æ­Œæ‰‹", "ç»¼è‰º", "ç”µè§†å‰§", "ç”µå½±", "ç¥¨æˆ¿", "å¯¼æ¼”",
            "å¨±ä¹", "å…«å¦", "ç»¯é—»", "æ‹æƒ…", "ç»“å©š", "ç¦»å©š", "å‡ºè½¨", "çˆ†æ–™",
            "ç½‘çº¢", "ä¸»æ’­", "ç›´æ’­", "çŸ­è§†é¢‘", "åæ§½", "åƒç“œ", "çˆ†æ–™"
        ],
    }

    @classmethod
    def detect_article_type(cls, title: str, summary: str = "") -> ArticleType:
        """
        æ ¹æ®æ ‡é¢˜å’Œæ‘˜è¦è‡ªåŠ¨è¯†åˆ«æ–‡ç« ç±»å‹

        Args:
            title: æ–‡ç« æ ‡é¢˜
            summary: æ–‡ç« æ‘˜è¦

        Returns:
            æ–‡ç« ç±»å‹
        """
        text = f"{title} {summary}".lower()

        scores = {}
        for article_type, keywords in cls.TYPE_KEYWORDS.items():
            score = sum(1 for keyword in keywords if keyword.lower() in text)
            scores[article_type] = score

        # è¿”å›å¾—åˆ†æœ€é«˜çš„ç±»å‹ï¼Œå¦‚æœéƒ½ä¸º0åˆ™è¿”å›ç¤¾ä¼šæ°‘ç”Ÿ
        if max(scores.values()) == 0:
            return ArticleType.SOCIAL

        return max(scores, key=scores.get)

    @classmethod
    def get_template(cls, article_type: ArticleType) -> Dict[str, Any]:
        """
        è·å–æŒ‡å®šç±»å‹çš„æ¨¡æ¿

        Args:
            article_type: æ–‡ç« ç±»å‹

        Returns:
            æ¨¡æ¿å­—å…¸
        """
        return cls.TEMPLATE_MAP.get(article_type, cls.SOCIAL_TEMPLATES)

    @classmethod
    def generate_article_prompt(
        cls,
        title: str,
        summary: str,
        source: str,
        article_type: ArticleType = None
    ) -> str:
        """
        ç”ŸæˆAIå†™ä½œæç¤ºè¯ - ä¸“ä¸šè‡ªåª’ä½“åˆ›ä½œè€…è§’åº¦
        
        ä¼˜åŒ–è¦ç‚¹ï¼š
        1. å¼ºè°ƒæ ‡é¢˜åˆ›ä½œæŠ€å·§å’Œä¼ æ’­æ€§
        2. æä¾›å…·ä½“çš„å†…å®¹æ¡†æ¶å’Œé’©å­å†™æ³•
        3. å¼ºè°ƒæƒ…ç»ªè°ƒåŠ¨å’Œå…±é¸£æ„Ÿ
        4. ç»™å‡ºå¯æ“ä½œçš„ç»“æ„æŒ‡å¯¼
        
        Args:
            title: æ–°é—»æ ‡é¢˜
            summary: æ–°é—»æ‘˜è¦
            source: æ–°é—»æ¥æº
            article_type: æ–‡ç« ç±»å‹ï¼ˆå¯é€‰ï¼Œè‡ªåŠ¨è¯†åˆ«ï¼‰

        Returns:
            AIæç¤ºè¯
        """
        import re
        
        # æ¸…ç†æ‘˜è¦ï¼ˆç§»é™¤HTMLæ ‡ç­¾ã€"æŸ¥çœ‹å…¨æ–‡"ç­‰æ— ç”¨æ–‡æœ¬ï¼‰
        def clean_summary(text: str) -> str:
            if not text:
                return ""
            # ç§»é™¤HTMLæ ‡ç­¾
            text = re.sub(r'<[^>]+>', '', text)
            # ç§»é™¤"æŸ¥çœ‹å…¨æ–‡"ã€"å±•å¼€å…¨æ–‡"ã€"é˜…è¯»æ›´å¤š"ç­‰
            text = re.sub(r'(æŸ¥çœ‹å…¨æ–‡|å±•å¼€å…¨æ–‡|é˜…è¯»æ›´å¤š|ç‚¹å‡»æŸ¥çœ‹|å…¨æ–‡|æ›´å¤šè¯¦æƒ…|å¤åˆ¶é“¾æ¥|æ‰“å¼€APP).*', '', text, flags=re.IGNORECASE)
            # ç§»é™¤æ—¥æœŸæ ‡è®°
            text = re.sub(r'^[ğŸ“…ğŸ—“â°]\s*', '', text)
            # ç§»é™¤ä½œè€…ä¿¡æ¯
            text = re.sub(r'[ä½œè‘—]è€…[ï¼š:]\s*\S+', '', text)
            # ç§»é™¤"..."ç»“å°¾çš„æˆªæ–­æ ‡è®°
            text = re.sub(r'\.\.\.$', '...', text)
            # æ¸…ç†å¤šä½™ç©ºç™½
            text = re.sub(r'\s+', ' ', text).strip()
            return text
        
        clean_sum = clean_summary(summary)
        if not clean_sum:
            clean_sum = title

        if article_type is None:
            article_type = cls.detect_article_type(title, clean_sum)

        template = cls.get_template(article_type)
        
        # æå–å…³é”®è¯ç”¨äºæ ‡é¢˜åˆ›ä½œ
        keywords = cls._extract_keywords(title)

        prompt = f"""åŸºäºä»¥ä¸‹ç´ æåˆ›ä½œä¸“ä¸šå…¬ä¼—å·æ–‡ç« ï¼š

ã€åŸå§‹ç´ æ - å¿…é¡»åŸºäºä»¥ä¸‹å†…å®¹åˆ›ä½œï¼Œä¸èƒ½åç¦»ã€‘
æ ‡é¢˜ï¼š{title}
å†…å®¹ï¼š{clean_sum}
æ¥æºï¼š{source}
ç±»å‹ï¼š{template['name']}

ã€å¼ºåˆ¶è¦æ±‚ - è¿åä¼šå¯¼è‡´å†…å®¹ä¸åˆæ ¼ã€‘
1. **å¿…é¡»åŸºäºä¸Šè¿°åŸå§‹ç´ æåˆ›ä½œ** - æ–‡ç« å¿…é¡»å›´ç»•è¿™ä¸ªå…·ä½“æ–°é—»äº‹ä»¶å±•å¼€ï¼Œä¸èƒ½å†™æˆé€šç”¨æ¨¡æ¿
2. **å¼€å¤´å¿…é¡»å¼•ç”¨å…·ä½“æ–°é—»** - ç¬¬ä¸€æ®µå¿…é¡»æåŠ"{title[:20]}..."è¿™ä¸ªå…·ä½“äº‹ä»¶ï¼Œå»ºç«‹å…³è”
3. **å¿…é¡»å¼•ç”¨åŸæ–‡ä¿¡æ¯** - æ­£æ–‡å¿…é¡»åŒ…å«åŸæ–‡çš„å…·ä½“æ•°æ®ã€äº‹å®ã€è§‚ç‚¹ï¼Œä¸èƒ½å…¨æ˜¯æ³›æ³›è€Œè°ˆ
4. **é’ˆå¯¹æ€§åˆ†æ** - åˆ†æå¿…é¡»é’ˆå¯¹è¿™ä¸ªå…·ä½“äº‹ä»¶ï¼Œä¸æ˜¯é€šç”¨çš„"è¿‘å¹´æ¥..."
5. **ç¦æ­¢å¥—è¯** - ç¦æ­¢ä½¿ç”¨"éšç€æ—¶ä»£çš„å‘å±•""åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£"ç­‰ä¸‡èƒ½å¼€å¤´

ã€å†…å®¹å…³è”æ€§æ£€æŸ¥ã€‘
å†™å®Œåè¯·è‡ªæ£€ï¼šå¦‚æœå»æ‰åŸæ ‡é¢˜ï¼Œè¯»è€…èƒ½çœ‹å‡ºè¿™æ˜¯é’ˆå¯¹å“ªä¸ªå…·ä½“äº‹ä»¶å†™çš„å—ï¼Ÿå¦‚æœä¸èƒ½ï¼Œè¯·é‡å†™ã€‚

ã€æ ‡é¢˜åˆ›ä½œ - å¿…é¡»åšåˆ°ã€‘
ä»ä»¥ä¸‹è§’åº¦åˆ›ä½œ3ä¸ªå¤‡é€‰æ ‡é¢˜ï¼Œé€‰æ‹©æœ€ä½³ï¼š

1. **æ‚¬å¿µå¼æ ‡é¢˜**ï¼ˆåˆ¶é€ å¥½å¥‡ï¼‰
   - "æˆ‘ä»¥ä¸º...æ²¡æƒ³åˆ°..."
   - "çœ‹å®Œè¿™ä¸ªæ•°æ®ï¼Œæˆ‘æ²‰é»˜äº†"
   - "çœŸç›¸å¯èƒ½ä¼šè®©ä½ æ„å¤–"

2. **æ•°å­—å¼æ ‡é¢˜**ï¼ˆå…·ä½“å¯ä¿¡ï¼‰
   - "3ä¸ªçœŸç›¸"ã€"5ä¸ªæ–¹æ³•"
   - "87%çš„äººä¸çŸ¥é“"
   - "è¶…è¿‡4200ä¸‡æ¬¡"

3. **æƒ…ç»ªå¼æ ‡é¢˜**ï¼ˆå¼•å‘å…±é¸£ï¼‰
   - "æ‰å¿ƒäº†"
   - "å¤ªçœŸå®äº†"
   - "ç»†æ€ææ"

å…³é”®è¯å‚è€ƒï¼š{keywords}

ã€å†…å®¹ç»“æ„ - ä¸¥æ ¼éµå¾ªã€‘

**ä¸€ã€å¼€å¤´é’©å­ï¼ˆ100-150å­—ï¼‰**
å¿…é¡»åŒ…å«ï¼š
- åœºæ™¯ä»£å…¥ï¼š"çœ‹åˆ°è¿™æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘æ­£åœ¨..."
- æƒ…ç»ªå…±é¸£ï¼š"è¯´å®è¯ï¼Œçœ‹åˆ°è¿™ä¸ªæˆ‘æœ‰ç‚¹éœ‡æƒŠ/æ‹…å¿ƒ/å¥½å¥‡..."
- ä»·å€¼é¢„å‘Šï¼š"ä»Šå¤©æˆ‘æƒ³è·Ÿä½ èŠèŠè¿™èƒŒåçš„çœŸç›¸"

å‚è€ƒé£æ ¼ï¼š{random.choice(template['openings'])}

**äºŒã€æ­£æ–‡å±•å¼€ï¼ˆ3-4èŠ‚ï¼Œæ¯èŠ‚200-300å­—ï¼‰**
{chr(10).join(f"ç¬¬{i+1}èŠ‚ {angle['title']}" for i, angle in enumerate(template['angles']))}

æ¯èŠ‚è¦æ±‚ï¼š
- å…ˆäº®è§‚ç‚¹ï¼Œå†ç»™æ•°æ®/æ¡ˆä¾‹
- åŠ å…¥æ´å¯Ÿï¼š"å¾ˆå¤šäººæ²¡æ³¨æ„åˆ°çš„æ˜¯..."
- æ®µè½ä¸è¶…è¿‡3è¡Œï¼Œé€‚åˆæ‰‹æœºé˜…è¯»

**ä¸‰ã€é‡‘å¥æç‚¼ï¼ˆ1-2å¥ï¼‰**
å‚è€ƒé£æ ¼ï¼š
{chr(10).join(f"- {q}" for q in template['quotes'][:3])}

è¦æ±‚ï¼šæœ—æœ—ä¸Šå£ï¼Œé€‚åˆè½¬å‘å’Œæˆªå›¾

**å››ã€äº’åŠ¨ç»“å°¾ï¼ˆ50-80å­—ï¼‰**
å‚è€ƒæ–¹å‘ï¼š
- "ä½ æ€ä¹ˆçœ‹ï¼Ÿæ˜¯Aè¿˜æ˜¯Bï¼Ÿ"
- "æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ•…äº‹"
- "å…³äºè¿™ä¸ªè¯é¢˜ï¼Œä¸‹æœŸæ·±å…¥èŠèŠ..."

å‚è€ƒé£æ ¼ï¼š{random.choice(template['endings'])}

ã€å†™ä½œé£æ ¼æ£€æŸ¥æ¸…å•ã€‘
âœ“ ç”¨"æˆ‘"å’Œ"ä½ "æ‹‰è¿‘è·ç¦»
âœ“ å…³é”®æ•°æ®åŠ ç²—ï¼Œå…³é”®è§‚ç‚¹åŠ ç²—
âœ“ é€‚å½“ä½¿ç”¨emojiåˆ†æ®µï¼ˆğŸ“ŠğŸ’¡ğŸ”¥ï¼‰
âœ“ å…·ä½“æ•°æ®æ›¿ä»£"å¾ˆå¤šäºº""å¤§éƒ¨åˆ†"
âœ“ é¿å…"éœ‡æƒŠ""é‡ç£…"ç­‰å¤¸å¼ è¯
âœ“ æœ‰è§‚ç‚¹ã€æœ‰æ€åº¦ã€æœ‰æ¸©åº¦

ã€è´¨é‡è‡ªæ£€ã€‘
- æ ‡é¢˜èƒ½å¦è®©æˆ‘æƒ³ç‚¹å‡»ï¼Ÿ
- å¼€å¤´èƒ½å¦è®©æˆ‘æƒ³ç»§ç»­è¯»ï¼Ÿ
- è§‚ç‚¹æ˜¯å¦æ¸…æ™°æœ‰æ–°æ„ï¼Ÿ
- æ˜¯å¦æœ‰å€¼å¾—è½¬å‘çš„é‡‘å¥ï¼Ÿ
- ç»“å°¾èƒ½å¦å¼•å‘è¯„è®ºï¼Ÿ

ã€è¾“å‡ºè¦æ±‚ã€‘
- Markdownæ ¼å¼
- å­—æ•°ï¼š800-1200å­—
- æ ‡é¢˜æ”¾ç¬¬ä¸€è¡Œï¼Œä¸åŠ "æ ‡é¢˜ï¼š"å‰ç¼€
- è¯­è¨€è‡ªç„¶ï¼ŒåƒçœŸäººå†™ä½œ

å¼€å§‹åˆ›ä½œï¼š"""

        return prompt
    
    @classmethod
    def _extract_keywords(cls, title: str) -> str:
        """æå–æ ‡é¢˜å…³é”®è¯ç”¨äºåˆ›ä½œå‚è€ƒ"""
        import re
        
        # æå–2-5å­—çš„å…³é”®è¯
        keywords = []
        stop_words = ['çš„', 'äº†', 'æ˜¯', 'åœ¨', 'æˆ‘', 'æœ‰', 'å’Œ', 'å°±', 'ä¸', 'äºº', 
                      'éƒ½', 'ä¸€', 'ä¸€ä¸ª', 'è¿™ä¸ª', 'é‚£ä¸ª', 'ä»Šå¤©', 'ç°åœ¨']
        
        for i in range(len(title)):
            for j in range(i+2, min(i+6, len(title)+1)):
                word = title[i:j]
                if word not in stop_words:
                    keywords.append(word)
        
        # å»é‡å–å‰5ä¸ª
        unique = list(dict.fromkeys(keywords))[:5]
        return "ã€".join(unique) if unique else title[:15]

    @classmethod
    def get_all_template_info(cls) -> List[Dict[str, str]]:
        """è·å–æ‰€æœ‰æ¨¡æ¿ä¿¡æ¯"""
        return [
            {
                "type": t.value,
                "name": cls.TEMPLATE_MAP[t]["name"],
                "description": cls.TEMPLATE_MAP[t]["description"],
            }
            for t in ArticleType
        ]


# ä¾¿æ·å‡½æ•°
def detect_type(title: str, summary: str = "") -> str:
    """æ£€æµ‹æ–‡ç« ç±»å‹"""
    return WritingTemplate.detect_article_type(title, summary).value


def generate_prompt(title: str, summary: str, source: str, article_type: str = None) -> str:
    """ç”Ÿæˆå†™ä½œæç¤ºè¯"""
    if article_type:
        t = ArticleType(article_type)
    else:
        t = None
    return WritingTemplate.generate_article_prompt(title, summary, source, t)


def get_template_list() -> List[Dict[str, str]]:
    """è·å–æ¨¡æ¿åˆ—è¡¨"""
    return WritingTemplate.get_all_template_info()


# å¯¼å‡ºæœåŠ¡å®ä¾‹ï¼ˆä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ï¼‰
writing_template_service = WritingTemplate